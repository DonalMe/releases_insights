<?php

require_once __DIR__.'/../app/bootstrap.php';

$version = $params['version'];
$query = 'https://bugzilla.mozilla.org/rest/bug?include_fields=id&chfield=cf_status_firefox67&chfieldfrom=2019-03-18&chfieldto=NOW&chfieldvalue=fixed&f0=OP&f1=OP&f10=delta_ts&f11=CP&f12=CP&f13=days_elapsed&f14=attachments.ispatch&f15=flagtypes.name&f2=flagtypes.name&f3=flagtypes.name&f4=flagtypes.name&f5=flagtypes.name&f6=CP&f7=CP&f8=OP&f9=OP&include_fields=id%2Csummary%2Cstatus%2Cproduct%2Ccomponent%2Ckeywords&j9=OR&o10=changedby&o14=substring&o15=substring&o2=substring&o3=substring&o4=changedafter&o5=substring&v15=approval-mozilla-beta%2B';
// $results = array_column(getJson($query, $query)['bugs'], 'id');

$real = getJson('https://pascalc.net/firefoxuplifts/?version='.$version.'&json')['total'];

// copy/pasted from a csv for 67 until I get a working api call
$results = [
    66 => [
        1522507, 1523333, 1523788, 1431582, 1523228, 1521713, 1522458, 1522314, 1513687, 1517410, 1523154, 1523243, 1522779, 1524340, 1513309, 1521696, 1518947, 1523013, 1524565, 1522951, 1522964, 1520783, 1523181, 1523926, 1523578, 1521368, 1523721, 1512010, 1523166, 1523003, 1523665, 1462885, 1496566, 1523160, 1525546, 1526252, 1524529, 1485016, 1520962, 1524707, 1526473, 1525569, 1525450, 1521053, 1523515, 1524857, 1521687, 1526504, 1525087, 1496684, 1525818, 1522535, 1522839, 1515132, 1522218, 1525343, 1524142, 1523956, 1522780, 1520656, 1525872, 1506976, 1522151, 1527471, 1527898, 1522755, 1524604, 1519376, 1521466, 1525075, 1529139, 1514840, 1509752, 1529027, 1524358, 1481244, 1522294, 1522923, 1529349, 1470926, 1516806, 1528715, 1530327, 1527768, 1524210, 1524995, 1509847, 1529467, 1527951, 1523558, 1529352, 1527526, 1529642, 1503745, 1527372, 1511358, 1525874, 1528276, 1530588, 1522264, 1472589, 1516665, 1519058, 1519095, 1506495, 1520808, 1521209, 1521577, 1521579, 1521599, 1522039, 1523285, 1523556, 1523635, 1523817, 1524145, 1524258, 1524888, 1525099, 1525340, 1525625, 1525763, 1526609, 1526793, 1527648, 1527658, 1527701, 1529658, 1527007, 1526477, 1531655, 1531178, 1515651, 1511053, 1522773, 1527626, 1524966, 1522381, 1523305, 1526054, 1530657, 1525341, 1532851, 1530557, 1527151, 1522053, 1524419, 1529312, 1521233, 1531443, 1521939, 1530288, 1530367, 1522820, 1523598, 1519418, 1520666, 1524640, 1526971, 1533408, 1526276, 1526355, 1530594, 1526045, 1533389, 1532756, 1527572, 1531689, 1532685, 1516754, 1525357, 1533388, 1530519, 1521082, 1528034, 1528304, 1527148, 1473830, 1532708, 1525267, 1532719, 1530816, 1525588, 1527235, 1523427, 1512731, 1524500, 1530625, 1514417, 1530132, 1526023, 1523329, 1532346, 1521639, 1515088, 1448505, 1525145, 1531277, 1518001, 1527717, 1521360, 1521214, 1523362, 1524335, 1525549, 1524755, 1526579, 1528199, 1523249, 1524214, 1415508, 1521304, 1522987, 1527534, 1518774, 1524246, 1524946, 1524264, 1530881, 1524554, 1535766, 1530958, 1522339, 1523052, 1524674, 1530423, 1530549, 1523611, 1525937, 1537924, 1522058, 1530103, 1516240, 377496, 1498639, 1524212, 1528943, 1522898, 1386487, 1538966, 1529203, 1382637, 1484524, 1518581, 1522077, 1523944, 1531867, 1532171, 1539618, 1450893, 1537609, 1530177, 1514073, 1528829, 1514031, 1528613, 1520760, 1521774, 1528097, 1522092, 1423917, 1527120, 1530220, 1529248, 1502817, 1525230, 1504251, 1524692, 1522026, 1531751, 1549249, 1504766, 1540017, 1525509, 1528909, 1526218, 1525817, 1514940, 1535612, 1538666, 1523696, 1512567, 1514682, 1516425, 1506665, 1516834, 1538970, 1506102, 1532599, 1529713, 1515823, 1521194, 1439023, 1475564, 1519037, 1524028, 1526387, 1520483, 1525433, 1524321, 1529730, 1524322, 1518258, 1514890, 1524632, 1519879, 1525413, 1524669, 1523381, 1527264, 1525366, 1525391, 1525494, 1526861, 1531604, 1527195, 1527347, 1527397, 1522832, 1527437, 1526366, 1520258, 1525581, 1527702, 1533089, 1518863, 1528140, 1519553, 1529673, 1527370, 1524119, 1461244,
    ],
    67 => [
        1533654, 1536059, 1535962, 1536466, 1534290, 1533688, 1537566, 1530305, 1534213, 1535584, 1536264, 1534629, 1535766, 1535701, 1422815, 1537587, 1537924, 1538253, 1535986, 1535441, 1536123, 1533150, 1537542, 1536752, 1537707, 1538021, 1539211, 1512472, 1530659, 1536157, 1462911, 1530507, 1535307, 1533539, 1538285, 1540171, 1539101, 1536538, 1537725, 1537675, 1534442, 1529559, 1537883, 1539757, 1534202, 1538987, 1536110, 1539309, 1538575, 1535631, 1539255, 1531333, 1533172, 1538762, 1533405, 1538966, 1538546, 1539817, 1539813, 1533290, 1528573, 1535080, 1536220, 1541597, 1534447, 1536387, 1535253, 1539137, 1541168, 1518807, 1538378, 1536521, 1538643, 1539647, 1532730, 1529556, 1534340, 1538455, 1539311, 1533989, 1530351, 1541314, 1534492, 1540944, 1530706, 1539172, 1538974, 1539618, 1450893, 1540112, 1540231, 1539408, 1536773, 1537609, 1536070, 1534209, 1520929, 1536575, 1543166, 1533263, 1541399, 1541088, 1542193, 1542221, 1541113, 1538708, 1541920, 1541804, 1540123, 1534219, 1539766, 1525642, 1539535, 1538236, 1498102, 1536194, 1543844, 1479145, 1536459, 1532165, 1542800, 1532530, 1528562, 1536427, 1540085, 1500719, 1506913, 1542933, 1534749, 1535794, 1514733, 1533764, 1544039, 1544074, 1524478, 1479433, 1525941, 1543617, 1543694, 1538083, 1541045, 1533789, 1544065, 1539348, 1423917, 1532746, 1544188, 1533071, 1543680, 1527666, 1543731, 1539784, 1540545, 1492668, 1538460, 1543828, 1537554, 1533925, 1544478, 1537964, 1546500, 1536850, 1546367, 1538952, 1545360, 1544525, 1545838, 1543314, 1536454, 1543584, 1531650, 1540251, 1540628, 1543350, 1544539, 1537723, 1546098, 1535040, 1540385, 1536866, 1529879, 1547191, 1515497, 1545190, 1539620, 1545575, 1538508, 1539414, 1546889, 1545807, 1543356, 1532850, 1532576, 1547852, 1538648, 1546326, 1542213, 1539208, 1542827, 1493611, 1545273, 1546599, 1540154, 1533559, 1541339, 1537589, 1535585, 1541449, 1546415, 1535866, 1536229, 1548000, 1545593, 1544023, 1536447, 1548626, 1532203, 1538474, 1535808, 1540637, 1528690, 1528319, 1537640, 1382650, 1543555, 1548959, 1529892, 1538737, 1527182, 1542921, 1539959, 1531057, 1519007, 1549249, 1530188, 1470107, 1543641, 1540017, 1538218, 1508961, 1539220, 1536159, 1546836, 1535393, 1542324, 1542829, 1534196, 1535612, 1538619, 1542097, 1540166, 1540136, 1543159, 1528939, 1542581, 1532465, 1540221, 1536405, 1539393, 1538736, 1546327, 1534593, 1546544, 1541580, 1533554, 1541927, 1538583, 1538666, 1545842, 1516425, 1516325, 1542465, 1544670, 1519013, 1538970, 1544589, 1536768, 1532599, 1546617, 1555179, 1537117, 1532525, 1525209, 1527511, 1535995, 1525372, 1545805, 1516333, 1546139, 1547073, 1521158, 1513019, 1554744, 1555962, 1551282, 1539846, 1536877, 1556076, 1552275, 1527778, 1547924, 1522817, 1536783, 1533704, 1525977, 1548042, 1542541, 1534699, 1495363, 1541317, 1538042, 1549833, 1552627, 1527704, 1556612, 1544792, 1550098, 1541489, 1524619, 1535301, 1527463, 1481164, 1532170, 1553413, 1539640, 1548410, 1554167, 1544386, 1539541, 1535194, 1554029, 1545232,
    ],
    68 => [
        1536159, 1553028, 1550697, 1552602, 1552362, 1552652, 1553481, 1553029, 1553031, 1545842, 1530650, 1553226, 1553286, 1553400, 1552768, 1471698, 1516767, 1552789, 1552110, 1543387, 1552302, 1547184, 1550401, 1553166, 1553963, 1550531, 1543384, 1548362, 1552535, 1553304, 1555179, 1552609, 1554664, 1552780, 1533365, 1550771, 1546655, 1550695, 1551377, 1553261, 1554256, 1554998, 1555110, 1552987, 1554540, 1545247, 1551825, 1554665, 1511839, 1554778, 1555798, 1553910, 1553474, 1179266, 1552537, 1371618, 1553371, 1552453, 1553214, 1551563, 1552853, 1534552, 1536816, 1555453, 1555530, 1556880, 1556135, 1539366, 1549787, 1554095, 1554264, 1555425, 1555691, 1548629, 997353, 1550794, 1557164, 1557051, 1551582, 1555277, 1547116, 1551870, 1552719, 1556391, 1506514, 1516333, 1556481, 1551729, 1550059, 1523162, 1539379, 1557229, 1557286, 1554744, 1552717, 1555447, 1555645, 1556383, 1556559, 1554433, 1554502, 1553828, 1555962, 1553125, 1538270, 1552644, 1551282, 1524868, 1551183, 1487013, 1547331, 1551520, 1551213, 1532724, 1555589, 1556210, 1557259, 1558272, 1556766, 1546723, 1525186, 1552428, 416771, 1501277, 1524280, 1534394, 1543508, 1545410, 1550523, 1552687, 1553198, 1554542, 1550051, 1553448, 1555866, 1556076, 1531338, 1553213, 1556136, 1552275, 1557171, 1546752, 1552180, 1525185, 1553295, 1554141, 1555640, 1558112, 1554158, 1505330, 1548499, 1549797, 1557790, 1558561, 1556382, 1552145, 1557717, 1547924, 1558194, 1558188, 1551801, 1555956, 1553969, 1550911, 1552799, 1556389, 1556433, 1556774, 1557424, 1556019, 1557324, 1553972, 1558546, 1552998, 1556832, 1547193, 1559029, 1551185, 1557996, 1545400, 1559301, 1555584, 1555168, 1559375, 1550967, 1539699, 1554317, 1558574, 1549290, 1558305, 1558784, 1558628, 1542561, 1559184, 1549633, 1553743, 1534431, 1544359, 1554843, 1559859, 1559353, 1553009, 1551275, 1555076, 1550437, 1558743, 1558538, 1514809, 1554260, 1558499, 1555627, 1552787, 1549889, 1550858, 1547830, 1553205, 1559824, 1545421, 1560527, 1542478, 1556730, 1557820, 1557997, 1519940, 1561245, 1348503, 1557203, 1557792, 1552280, 1555067, 1560704, 1552248, 1535835, 1559316, 1559317, 1559264, 1561465, 1560587, 1555368, 1547624, 1558393, 1551458, 1555051, 1560064, 1554244, 1558917, 1549386, 1552596, 1559243, 1549052, 1560582, 1546446, 1551515, 1558540, 1557056, 1556220, 1557655, 1558549, 1553929, 1555117, 1559686, 1559858, 1561950, 1552627, 1555565, 1549930, 1553889, 1547217, 1556083, 1549812, 1560651, 1556230, 1550291, 1528082, 1539759, 1558856, 1558930, 1554217, 1556612, 1553065, 1554512, 1559946, 1552354, 1553650, 1551490, 1551541, 1552184, 1540253, 1559112, 1530660, 1539835, 1554038, 1552632, 1547760, 1549768, 1547266, 1547757, 1552541, 1539219, 1507696, 1543804, 1547472, 1555523, 1515052, 1528481, 1551907, 1548306, 1400563, 1552993, 1565315, 1556424, 1557555, 1555661, 1553413, 1552559, 1551554, 1552193, 1512162, 1553726, 1560336, 1556726, 1553737, 1557302, 1562837, 1565518, 1553228, 1551990, 1554289, 1558503, 1566206, 1559094, 1548612, 1554167, 1556846, 1551836, 1565779, 1553067, 1555044, 1489669, 1551671, 1563839, 1553776, 1555322, 1544386, 1556733, 1548679, 1527048, 1557256, 1554029, 1562315, 1538015, 1555012, 1544950,
    ],
];

echo "<h3>In $version hg but not in bugzilla query (".count(array_diff($real, $results[$version])).' bugs):</h3>';

function bugLink($id)
{
    return '<a href="https://bugzilla.mozilla.org/'.$id.'">'.$id.'</a>';
}
foreach (array_diff($real, $results[$version]) as $notinhg) {
    echo bugLink($notinhg).'<br>';
}

echo "<h3>In bugzilla query but was not committed to $version beta (".count(array_diff($results[$version], $real)).' bugs):</h3>';
foreach (array_diff($results[$version], $real) as $notinbz) {
    echo bugLink($notinbz).'<br>';
}
